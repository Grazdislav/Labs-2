:figure-caption: Рисунок
:toc: Оглавление

= Отчет по лабораторной работе №2
Макаров КЭ-413 +

==  Задание  +

1. Сделать бегущий огонь из 4 светодиодов, подключенных к портам C.5, C.8, C9, A.5

2. Заготовка лежит с настройками портов светодиодов лежит в https://github.com/lamer0k/stm32Labs/tree/master/Lab1

3. Сделать отчет как обычно

== Решение задачи

Для начала рассмотрим схему самой платы и проанализиурем, где расположены нужные нам порты.

.Схема платы XNucleo-F411RE.
[#img-sunset]
[link=https://github.com/MakarovSasha/Labs/blob/main/Lab3]
image::XNUCLEO-F411RE_4.jpg[Sunset, 600, 441]

Из схемы видно, что нам понадобятся PC_5, PC_9, PC_8, PC_5.

=== Код программы

Подключим библиотеки для портов С и А;

[source, cpp, linenums]

----
#include "gpioaregisters.hpp" // для GPIOC
#include "gpiocregisters.hpp" // для GPIOC
#include "rccregisters.hpp" // для RCC
----

[source, cpp, linenums]

----
std :: uint32_t SystemCoreClock = 16'000'000U;
[источник, c]
extern "C" {
int __low_level_init (недействительно)
{
// Включаем внешний генератор 16 МГц
RCC :: CR :: HSION :: On :: Set ();
в то время как (RCC :: CR :: HSIRDY :: NotReady :: IsSet ())
{
}
// Включаем системные часы на внешний осциллятор
RCC :: CFGR :: SW :: Hsi :: Set ();
в то время как (! RCC :: CFGR :: SWS :: Hsi :: IsSet ())
{
}
RCC :: APB2ENR :: SYSCFGEN :: Enable :: Set ();
возврат 1;
}
}
пустая задержка (целые циклы)
{
для (int i = 0; i <циклы; ++ i)
{
asm volatile ("");
}
}
int main ()
{
для(;;)
{
RCC :: AHB1ENR :: GPIOAEN :: Enable :: Set ();
GPIOA :: MODER :: MODER5 :: Output :: Set ();
RCC :: AHB1ENR :: GPIOCEN :: Enable :: Set ();
GPIOC :: MODER :: MODER5 :: Output :: Set ();
GPIOC :: MODER :: MODER8 :: Output :: Set ();
GPIOC :: MODER :: MODER9 :: Output :: Set ();
GPIOA :: ODR :: ODR5 :: High :: Set ();
задержка (1000000);
GPIOA :: ODR :: ODR5 :: Low :: Set ();
задержка (1000000);
GPIOC :: ODR :: ODR5 :: High :: Set ();
задержка (1000000);
GPIOC :: ODR :: ODR5 :: Low :: Set ();
задержка (1000000);
GPIOC :: ODR :: ODR8 :: High :: Set ();
задержка (1000000);
GPIOC :: ODR :: ODR8 :: Low :: Set ();
задержка (1000000);
GPIOC :: ODR :: ODR9 :: High :: Set ();
задержка (1000000);
GPIOC :: ODR :: ODR9 :: Low :: Set ();
задержка (1000000);
}
возврат 1;
}
----

=== Результат пргограммы

.Результат программы
[#img-sunset]
[link=https://github.com/MakarovSasha/Labs/blob/main/Lab3]
image::2_5404873719589900622.gif[Sunset, 388, 690]